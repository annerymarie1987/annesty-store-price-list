<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ANNESTY STORE</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        body { background: #f4f6f9; }
        h1 { font-weight: 700; }
        .statusCell { font-weight: bold; }
    </style>
</head>
<body class="p-3">

    <h1 class="text-center p-3 mb-4 border border-primary rounded bg-white">
        ANNESTY STORE
    </h1>

    <!-- NAV TABS -->
    <ul class="nav nav-tabs mb-3" id="myTab">
        <li class="nav-item">
            <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#priceList">Price List</button>
        </li>
        <li class="nav-item">
            <button class="nav-link" data-bs-toggle="tab" data-bs-target="#bnpl">Buy Now Pay Later Log</button>
        </li>
    </ul>

    <div class="tab-content">

        <!-- PRICE LIST TAB -->
        <div class="tab-pane fade show active" id="priceList">

            <!-- Search and Filter -->
            <div class="row mb-3">
                <div class="col-md-6">
                    <input id="searchInput" class="form-control" placeholder="Search item...">
                </div>
                <div class="col-md-4">
                    <select id="categoryFilter" class="form-select">
                        <option value="">All Categories</option>
                        <option value="DRINK">DRINK</option>
                        <option value="NOODLES">NOODLES</option>
                        <option value="SNACKS">SNACKS</option>
                    </select>
                </div>
            </div>

            <table class="table table-bordered table-hover bg-white" id="priceTable">
                <thead class="table-primary">
                    <tr>
                        <th>Description</th>
                        <th>Category</th>
                        <th>Office Price</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>

        <!-- BNPL TAB -->
        <div class="tab-pane fade" id="bnpl">

            <!-- Multi Item Form -->
            <div class="card p-3 mb-3">
                <h5>Log Items</h5>

                <form id="bnplForm">
                    <div class="row g-3 align-items-end mb-2 bnpl-row">
                        <div class="col-md-4">
                            <input type="text" class="form-control userName" placeholder="Name" required>
                        </div>
                        <div class="col-md-4">
                            <select class="form-select itemSelect" required></select>
                        </div>
                        <div class="col-md-3">
                            <input type="date" class="form-control purchaseDate" required>
                        </div>
                    </div>

                    <button type="button" id="addItemBtn" class="btn btn-secondary mb-2">Add Another Item</button>
                    <button type="submit" class="btn btn-success">Submit All</button>
                </form>
            </div>

            <!-- Search BNPL -->
            <div class="row g-2 mb-2">
                <div class="col-md-6">
                    <input id="bnplSearchInput" class="form-control" placeholder="Search BNPL logs...">
                </div>
                <div class="col-md-2">
                    <button id="bnplSearchBtn" class="btn btn-primary w-100">Search</button>
                </div>
                <div class="col-md-2">
                    <button id="bnplResetBtn" class="btn btn-outline-secondary w-100">Reset</button>
                </div>
            </div>

            <!-- CSV -->
            <button id="downloadCsv" class="btn btn-outline-primary mb-2">Download CSV</button>

            <table class="table table-sm bg-white" id="bnplTable">
                <thead class="table-success">
                    <tr>
                        <th>Name</th>
                        <th>Item</th>
                        <th>Price</th>
                        <th>Date</th>
                        <th>Status</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>

    </div>


    <!-- SCRIPT -->
    <script>
        // PRICE LIST DATA
        const items = [
            {desc:"Nescafe Original Twin",cat:"DRINK",price:20},
            {desc:"Nescafe Creamy Latte Twin",cat:"DRINK",price:20},
            {desc:"Kopiko Brown Twin",cat:"DRINK",price:20},
            {desc:"Kopiko Blanca Twin",cat:"DRINK",price:20},
            {desc:"Hiho Cruncy",cat:"SNACKS",price:3},
            {desc:"Nissin Noodles Cheese",cat:"NOODLES",price:30},
            {desc:"Nissin Noodles Creamy",cat:"NOODLES",price:30},
            {desc:"Nissin Noodles Spicy",cat:"NOODLES",price:30},
            {desc:"Nissin Noodles Seafood",cat:"NOODLES",price:30},
            {desc:"Mr Chips",cat:"SNACKS",price:20},
            {desc:"Tortillos Barbeque",cat:"SNACKS",price:20},
            {desc:"CrisCross",cat:"SNACKS",price:20},
            {desc:"Alibaba chips",cat:"SNACKS",price:20},
            {desc:"Super Crunch",cat:"SNACKS",price:3},
            {desc:"Tortillos Cheese",cat:"SNACKS",price:20},
            {desc:"Pier20 Prawn",cat:"SNACKS",price:20},
            {desc:"Nova",cat:"SNACKS",price:20},
            {desc:"Peewee",cat:"SNACKS",price:20},
            {desc:"Xsakto",cat:"SNACKS",price:3},
            {desc:"BoyBawang Small",cat:"SNACKS",price:3},
            {desc:"Tostas",cat:"SNACKS",price:20},
            {desc:"Chippy",cat:"SNACKS",price:20},
            {desc:"Clover",cat:"SNACKS",price:20},
            {desc:"Tomi",cat:"SNACKS",price:20},
            {desc:"Tostillas",cat:"SNACKS",price:30},
            {desc:"Vcut",cat:"SNACKS",price:30},
            {desc:"Piatos",cat:"SNACKS",price:30},
            {desc:"Happy Peanuts Small",cat:"SNACKS",price:5},
            {desc:"Pinatsu Seaweed",cat:"SNACKS",price:20},
            {desc:"Pinatsu Garlic",cat:"SNACKS",price:20},
            {desc:"Great Taste White",cat:"DRINK",price:20},
            {desc:"San Mig Coffee",cat:"SNACKS",price:15},
            {desc:"Nissin Noodles Beef",cat:"NOODLES",price:30},
            {desc:"Nissin Noodles Chicken",cat:"NOODLES",price:30},
            {desc:"Matcha",cat:"DRINK",price:20},
            {desc:"Milo",cat:"DRINK",price:15},
        ];

        const priceTable = document.querySelector("#priceTable tbody");

        function loadTable() {
            priceTable.innerHTML = "";
            items.forEach(i=>{
                const tr = document.createElement("tr");
                tr.innerHTML = `<td>${i.desc}</td><td>${i.cat}</td><td>${i.price}</td>`;
                priceTable.appendChild(tr);
            });
        }
        loadTable();

        // PRICE LIST SEARCH / FILTER
        searchInput.addEventListener("keyup", ()=> filterItems());
        categoryFilter.addEventListener("change", ()=> filterItems());

        function filterItems(){
            const s = searchInput.value.toLowerCase();
            const c = categoryFilter.value;

            const rows = priceTable.querySelectorAll("tr");
            rows.forEach(r=>{
                const text = r.textContent.toLowerCase();
                const cat = r.children[1].textContent;

                const match = text.includes(s) && (c==="" || cat===c);
                r.style.display = match ? "" : "none";
            });
        }

        // BNPL ITEMS DROPDOWN
        const selects = document.querySelectorAll(".itemSelect");
        function fillDropdowns() {
            selects.forEach(sel=>{
                sel.innerHTML = `<option value="">Select Item</option>`;
                items.forEach(i=>{
                    sel.innerHTML += `<option data-name="${i.desc}" data-price="${i.price}">${i.desc} - â‚±${i.price}</option>`;
                });
            });
        }
        fillDropdowns();

        // ADD MULTIPLE BNPL ROWS
        const bnplForm = document.getElementById("bnplForm");
        const firstSelect = document.querySelector(".itemSelect");
        const templateOptions = firstSelect.innerHTML;

        addItemBtn.addEventListener("click", ()=>{
            const row = document.createElement("div");
            row.className = "row g-3 align-items-end mb-2 bnpl-row";

            row.innerHTML = `
                <div class="col-md-4">
                    <input type="text" class="form-control userName" placeholder="Name" required>
                </div>
                <div class="col-md-4">
                    <select class="form-select itemSelect" required>${templateOptions}</select>
                </div>
                <div class="col-md-3">
                    <input type="date" class="form-control purchaseDate" required>
                </div>
                <div class="col-md-1">
                    <button type="button" class="btn btn-danger removeItemBtn">X</button>
                </div>
            `;
            bnplForm.insertBefore(row, addItemBtn);

            row.querySelector(".removeItemBtn").addEventListener("click", ()=>{
                row.remove();
            });
        });

        // SUBMIT ALL BNPL ITEMS
        const bnplTableBody = document.querySelector("#bnplTable tbody");

        bnplForm.addEventListener("submit", e=>{
            e.preventDefault();

            const rows = bnplForm.querySelectorAll(".bnpl-row");

            rows.forEach(r=>{
                const name = r.querySelector(".userName").value;
                const opt = r.querySelector(".itemSelect").selectedOptions[0];
                const itemName = opt.dataset.name;
                const price = opt.dataset.price;
                const date = r.querySelector(".purchaseDate").value;

                const tr = document.createElement("tr");
                tr.innerHTML = `
                    <td>${name}</td>
                    <td>${itemName}</td>
                    <td>${price}</td>
                    <td>${date}</td>
                    <td class="statusCell text-danger">UNPAID</td>
                    <td><button class="btn btn-sm btn-success markPaidBtn">Mark Paid</button></td>
                `;
                bnplTableBody.appendChild(tr);

                tr.querySelector(".markPaidBtn").addEventListener("click", ()=>{
                    const p = prompt("Admin Password:");
                    if(p==="BUBI123"){
                        tr.querySelector(".statusCell").textContent = "PAID";
                        tr.querySelector(".statusCell").style.color = "green";
                    } else {
                        alert("Incorrect password");
                    }
                });
            });

            // Reset form back to first row
            rows.forEach((r,i)=> i>0 ? r.remove() : null);
            rows[0].querySelector(".userName").value = "";
            rows[0].querySelector(".itemSelect").selectedIndex = 0;
            rows[0].querySelector(".purchaseDate").value = "";
        });

        // BNPL SEARCH
        bnplSearchBtn.addEventListener("click", ()=>{
            const q = bnplSearchInput.value.toLowerCase();
            const rows = bnplTableBody.querySelectorAll("tr");

            rows.forEach(r=>{
                const text = r.textContent.toLowerCase();
                r.style.display = text.includes(q) ? "" : "none";
            });
        });

        bnplResetBtn.addEventListener("click", ()=>{
            bnplSearchInput.value="";
            bnplTableBody.querySelectorAll("tr").forEach(r=> r.style.display="");
        });

        // CSV DOWNLOAD
        downloadCsv.addEventListener("click", ()=>{
            let csv = "Name,Item,Price,Date,Status\n";

            bnplTableBody.querySelectorAll("tr").forEach(r=>{
                const cols = r.querySelectorAll("td");
                let data = [];
                cols.forEach(c=> data.push(c.innerText));
                csv += data.join(",") + "\n";
            });

            const blob = new Blob([csv], {type:"text/csv"});
            const url = URL.createObjectURL(blob);

            const a = document.createElement("a");
            a.href = url;
            a.download = "BNPL_Log.csv";
            a.click();
        });

    </script>
</body>
</html>


